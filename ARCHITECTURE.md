# ğŸ—ï¸ System Architecture - NeoBank & Chrome Slots

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PLAYERS (Mobile Web)                     â”‚
â”‚                    iOS Safari / Android Chrome                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTPS
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      KUBERNETES CLUSTER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Ingress Controller                      â”‚  â”‚
â”‚  â”‚           (nginx-ingress / TLS termination)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚                         â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 NeoBank Service (ClusterIP)               â”‚  â”‚
â”‚  â”‚                     Load Balancer                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                               â”‚                    â”‚
â”‚             â–¼                               â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   NeoBank Pod 1  â”‚           â”‚   NeoBank Pod 2  â”‚  (N pods) â”‚
â”‚  â”‚                  â”‚           â”‚                  â”‚           â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚ â”‚   Flask App  â”‚ â”‚           â”‚ â”‚   Flask App  â”‚ â”‚           â”‚
â”‚  â”‚ â”‚  + Vue.js UI â”‚ â”‚           â”‚ â”‚  + Vue.js UI â”‚ â”‚           â”‚
â”‚  â”‚ â”‚   Gunicorn   â”‚ â”‚           â”‚ â”‚   Gunicorn   â”‚ â”‚           â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â”‚        â”‚         â”‚           â”‚        â”‚         â”‚           â”‚
â”‚  â”‚        â–¼         â”‚           â”‚        â–¼         â”‚           â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚ â”‚SQLite DB Fileâ”‚ â”‚           â”‚ â”‚SQLite DB Fileâ”‚ â”‚           â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â”‚                               â”‚                    â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                           â”‚                                    â”‚
â”‚                           â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Persistent Volume (PVC)                              â”‚  â”‚
â”‚  â”‚      /app/data/neobank.db                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ External API
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               EXTERNAL SYSTEMS (ESP32, Terminals)                â”‚
â”‚            API Key Authentication via HTTP/HTTPS                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Details

### Frontend Layer (Vue.js SPA)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Vue.js 3 Application           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ index.html                        â”‚
â”‚  â€¢ app.js (Main Vue app)             â”‚
â”‚  â€¢ cyberpunk.css (Dark theme)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Views:                              â”‚
â”‚  â”œâ”€ Authentication (Login/Register)  â”‚
â”‚  â”œâ”€ Bank Dashboard                   â”‚
â”‚  â”‚  â”œâ”€ Balance Display               â”‚
â”‚  â”‚  â”œâ”€ P2P Transfer                  â”‚
â”‚  â”‚  â””â”€ Transaction History           â”‚
â”‚  â”œâ”€ Casino                            â”‚
â”‚  â”‚  â”œâ”€ Glitch Grid (3-reel)          â”‚
â”‚  â”‚  â””â”€ Starlight Smuggler (5x3)      â”‚
â”‚  â””â”€ Admin Panel (GM only)            â”‚
â”‚     â”œâ”€ User Management                â”‚
â”‚     â”œâ”€ API Key Management             â”‚
â”‚     â””â”€ Casino Controls                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Backend Layer (Flask API)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Flask Application (app.py)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Routes:                                             â”‚
â”‚  â”œâ”€ /api/v1/auth/*           (Authentication)       â”‚
â”‚  â”œâ”€ /api/v1/account/*        (User account)         â”‚
â”‚  â”œâ”€ /api/v1/transactions     (P2P transfers)        â”‚
â”‚  â”œâ”€ /api/v1/casino/*         (Casino games)         â”‚
â”‚  â”œâ”€ /api/v1/external/*       (External API)         â”‚
â”‚  â””â”€ /admin/*                 (Admin panel)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Modules:                                            â”‚
â”‚  â”œâ”€ models.py     (Database ORM models)             â”‚
â”‚  â”œâ”€ auth.py       (JWT authentication)              â”‚
â”‚  â”œâ”€ transactions.py (Transaction engine)            â”‚
â”‚  â”œâ”€ casino.py     (Slot machine logic)              â”‚
â”‚  â””â”€ admin.py      (Admin functions)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Middleware:                                         â”‚
â”‚  â”œâ”€ Flask-CORS    (Cross-origin support)            â”‚
â”‚  â”œâ”€ Flask-Limiter (Rate limiting)                   â”‚
â”‚  â””â”€ Flask-JWT     (Token validation)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Schema

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USERS TABLE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id (PK)                                                  â”‚
â”‚  character_name (UNIQUE)                                  â”‚
â”‚  password_hash                                            â”‚
â”‚  account_number (UNIQUE, NC-XXXX-XXXX)                    â”‚
â”‚  faction                                                  â”‚
â”‚  balance                                                  â”‚
â”‚  is_admin                                                 â”‚
â”‚  created_at                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 1:N
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 TRANSACTIONS TABLE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id (PK)                                                  â”‚
â”‚  from_account_id (FK -> users.id)                        â”‚
â”‚  to_account_id (FK -> users.id)                          â”‚
â”‚  amount                                                   â”‚
â”‚  memo                                                     â”‚
â”‚  timestamp                                                â”‚
â”‚  transaction_type (transfer/casino_bet/casino_win/admin) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API_KEYS TABLE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id (PK)                                                  â”‚
â”‚  key_value (UNIQUE)                                       â”‚
â”‚  description                                              â”‚
â”‚  created_by_user_id (FK -> users.id)                     â”‚
â”‚  is_active                                                â”‚
â”‚  created_at                                               â”‚
â”‚  last_used                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AUDIT_LOGS TABLE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id (PK)                                                  â”‚
â”‚  admin_user_id (FK -> users.id)                          â”‚
â”‚  action                                                   â”‚
â”‚  target_user_id (FK -> users.id)                         â”‚
â”‚  details                                                  â”‚
â”‚  timestamp                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 CASINO_CONFIG TABLE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id (PK)                                                  â”‚
â”‚  game_name (glitch_grid / starlight_smuggler)            â”‚
â”‚  is_enabled                                               â”‚
â”‚  payout_percentage                                        â”‚
â”‚  updated_at                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow

### User Registration Flow

```
Client                Server              Database
  â”‚                     â”‚                    â”‚
  â”œâ”€â”€â”€ POST /register â”€â”€â–º                    â”‚
  â”‚     {name, pass}    â”‚                    â”‚
  â”‚                     â”œâ”€â”€â”€ Hash password â”€â”€â”¤
  â”‚                     â”‚                    â”‚
  â”‚                     â”œâ”€â”€â”€ Generate acct# â”€â”¤
  â”‚                     â”‚                    â”‚
  â”‚                     â”œâ”€â”€â”€ INSERT user â”€â”€â”€â”€â–º
  â”‚                     â”‚                    â”‚
  â”‚                     â—„â”€â”€â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                     â”‚                    â”‚
  â—„â”€â”€â”€â”€ 201 Created â”€â”€â”€â”€â”¤                    â”‚
  â”‚   {user data}       â”‚                    â”‚
```

### Transaction Flow (Atomic)

```
Client              Server              Database
  â”‚                   â”‚                    â”‚
  â”œâ”€â”€â”€ POST /tx â”€â”€â”€â”€â”€â”€â–º                    â”‚
  â”‚   {to, amt}       â”‚                    â”‚
  â”‚                   â”œâ”€â”€â”€ BEGIN TRANSACTION
  â”‚                   â”‚                    â”‚
  â”‚                   â”œâ”€â”€â”€ Check balance â”€â”€â–º
  â”‚                   â—„â”€â”€â”€â”€ balance â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                   â”‚                    â”‚
  â”‚                   â”œâ”€â”€â”€ sender.bal -= amt
  â”‚                   â”œâ”€â”€â”€ receiver.bal += amt
  â”‚                   â”œâ”€â”€â”€ INSERT transaction
  â”‚                   â”‚                    â”‚
  â”‚                   â”œâ”€â”€â”€ COMMIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                   â—„â”€â”€â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                   â”‚                    â”‚
  â—„â”€â”€â”€â”€ 201 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚   {tx data}       â”‚                    â”‚
```

### Casino Spin Flow

```
Client              Server              Database
  â”‚                   â”‚                    â”‚
  â”œâ”€â”€â”€ POST /spin â”€â”€â”€â”€â–º                    â”‚
  â”‚   {bet_amt}       â”‚                    â”‚
  â”‚                   â”œâ”€â”€â”€ Transfer bet â”€â”€â”€â–º
  â”‚                   â”‚   (player â†’ house)  â”‚
  â”‚                   â”‚                    â”‚
  â”‚                   â”œâ”€â”€â”€ Generate spin â”€â”€â”¤
  â”‚                   â”‚   (server-side RNG)â”‚
  â”‚                   â”‚                    â”‚
  â”‚                   â”œâ”€â”€â”€ Calculate win â”€â”€â”¤
  â”‚                   â”‚                    â”‚
  â”‚                   â”œâ”€â”€â”€ Transfer win â”€â”€â”€â–º
  â”‚                   â”‚   (house â†’ player)  â”‚
  â”‚                   â”‚                    â”‚
  â—„â”€â”€â”€â”€ 200 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚   {reels, win}    â”‚                    â”‚
```

---

## Security Architecture

### Authentication Flow (JWT)

```
1. User Login
   â”œâ”€ Client sends credentials
   â”œâ”€ Server validates via bcrypt
   â”œâ”€ Server generates JWT token
   â”‚  â””â”€ Payload: {user_id, exp}
   â””â”€ Client stores token (localStorage)

2. Authenticated Requests
   â”œâ”€ Client includes: Authorization: Bearer <token>
   â”œâ”€ Server validates JWT signature
   â”œâ”€ Server checks expiration
   â””â”€ Server extracts user_id from payload

3. Token Expiry
   â””â”€ Default: 24 hours (configurable)
```

### API Key Authentication

```
External System
   â”‚
   â”œâ”€â”€â”€ HTTP Request
   â”‚    Header: X-API-Key: <key>
   â”‚
   â–¼
Server validates:
   â”œâ”€ Key exists in database
   â”œâ”€ Key is active
   â”œâ”€ Update last_used timestamp
   â””â”€ Process request
```

---

## Deployment Patterns

### Development (Docker Compose)

```
Host Machine
  â””â”€ docker-compose.yml
     â””â”€ neobank container
        â”œâ”€ Flask app (port 5000)
        â”œâ”€ SQLite DB (volume mounted)
        â””â”€ Exposed on host:8080
```

### Production (Kubernetes)

```
Kubernetes Cluster
  â””â”€ Namespace: neotropolis
     â”œâ”€ Ingress (external access)
     â”œâ”€ Service (load balancing)
     â”œâ”€ Deployment (2+ replicas)
     â”‚  â””â”€ Pods
     â”‚     â”œâ”€ Container: neobank
     â”‚     â””â”€ Liveness/Readiness probes
     â”œâ”€ PersistentVolumeClaim (database)
     â”œâ”€ ConfigMap (non-sensitive config)
     â””â”€ Secret (SECRET_KEY)
```

---

## Scaling Considerations

### Horizontal Scaling

- **Pods**: Can run multiple replicas
- **Session Affinity**: Configured on Service
- **Database**: SQLite limitations (read-heavy OK, write-heavy needs PostgreSQL)

### Vertical Scaling

```yaml
resources:
  requests:
    memory: "256Mi"
    cpu: "250m"
  limits:
    memory: "512Mi"    # Increase for high load
    cpu: "500m"        # Increase for high load
```

### Database Migration Path

For >500 concurrent users, consider:
```
SQLite â†’ PostgreSQL
  â”œâ”€ Change DATABASE_URL
  â”œâ”€ Use CloudNativePG operator
  â””â”€ Update deployment to use external DB
```

---

## Monitoring & Observability

### Health Checks

```
GET /health
Response: {"status": "healthy", "service": "neobank"}
```

### Logs

```
Application logs â†’ stdout
  â”œâ”€ Captured by Kubernetes
  â””â”€ Viewable via: kubectl logs
```

### Metrics (Future Enhancement)

- Prometheus integration
- Grafana dashboards
- Alert on high error rates
- Track transaction volume

---

## Backup Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Automated Backup Schedule          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Daily: 2 AM (kubectl cp)         â”‚
â”‚  â€¢ Weekly: Full snapshot            â”‚
â”‚  â€¢ Retention: 30 days               â”‚
â”‚  â€¢ Location: S3/Azure Blob          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Disaster Recovery

1. **Database Corruption**
   - Restore from last backup
   - Replay transaction logs (if available)

2. **Pod Failure**
   - Kubernetes auto-restarts
   - Service routes to healthy pods

3. **Cluster Failure**
   - Backup database file stored externally
   - Redeploy to new cluster
   - Restore database

---

**Architecture designed for reliability, security, and scalability at LARP event scale (100-500 users)** ğŸŒƒ
